
PATCH: app/routers/dashboard.py

Что изменено:
- Гарантированно передаётся переменная `user` в шаблон (берётся из `request.session`).
- Если сессии нет — редирект на `/login` (303).
- Безопасно считаются счётчики сотрудников/отделов (если нет БД/моделей — просто 0).
- Импорт моделей/БД обёрнут в try/except, чтобы не падать при различиях в путях.

Как применить:
1) Замените файл `app/routers/dashboard.py` содержимым из этого патча.
2) Перезапустите сервер: `uvicorn app.main:app --reload --host 127.0.0.1 --port 8000`.

Примечание по шаблону `templates/dashboard.html`:
Если всё ещё появится ошибка на строке с приветствием, замените выражение на безопасное:
    {{ (user|default({})).full_name|default((user|default({})).username)|default('Пользователь') }}
